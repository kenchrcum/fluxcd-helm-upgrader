image:
  repository: kenchrcum/fluxcd-helm-upgrader
  tag: "0.6.4"
  pullPolicy: IfNotPresent

# Deployment mode: "deployment" for continuous operation, "cronjob" for scheduled execution
mode: deployment

# Deployment configuration (used when mode=deployment)
replicaCount: 1

# CronJob configuration (used when mode=cronjob)
cronjob:
  # Schedule in cron format (e.g., "0 */6 * * *" for every 6 hours)
  schedule: "0 */6 * * *"
  # How to handle concurrent executions
  concurrencyPolicy: Forbid  # Options: Allow, Forbid, Replace
  # Number of successful finished jobs to retain
  successfulJobsHistoryLimit: 3
  # Number of failed finished jobs to retain
  failedJobsHistoryLimit: 1
  # Optional: Deadline in seconds for starting the job if it misses scheduled time
  startingDeadlineSeconds: 300
  # Optional: Suspend the cron job
  suspend: false
  # Optional: Deadline in seconds for the job execution
  activeDeadlineSeconds: 3600  # 1 hour timeout
  # Optional: Number of retries before marking job as failed
  backoffLimit: 3

resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 50m
    memory: 64Mi

nodeSelector: {}

tolerations: []

affinity: {}

serviceAccount:
  create: true
  name: ""

rbac:
  create: true
  clusterWide: true

logLevel: INFO
intervalSeconds: 300
includePrerelease: false

podAnnotations: {}

# Git repository configuration to locate HelmRelease manifests in Flux repo
repo:
  url: ""
  branch: ""
  # Pattern supports placeholders: {namespace}, {name}
  searchPattern: "/components/{namespace}/*/helmrelease*.y*ml"
  # Optional: mount path inside container where repo will be cloned
  cloneDir: "/tmp/fluxcd-repo"

  # SSH key authentication (recommended for private repos)
  sshKeySecret:
    enabled: false
    name: ""
    privateKey: "id_rsa"        # Key name for private key in secret
    publicKey: "id_rsa.pub"     # Key name for public key in secret
    knownHosts: "known_hosts"   # Key name for known_hosts in secret

# GitHub integration for automatic Pull Request creation
github:
  # Secret containing GitHub token
  tokenSecret:
    enabled: false
    name: ""                   # Name of the secret containing the GitHub token
    key: "token"               # Key name in the secret containing the token
  repository: ""               # GitHub repository in format 'owner/repo'
  defaultBranch: ""            # Override default branch detection (optional)

  # PR Assignee configuration (optional)
  defaultAssignee: ""          # Default GitHub user to assign to all PRs
  assigneesByNamespace: ""     # JSON mapping of namespaces to GitHub users
  assigneesByHelmRelease: ""   # JSON mapping of HelmRelease names to GitHub users

# Git configuration for commits
git:
  userName: "fluxcd-helm-upgrader"           # Git user name for commits
  userEmail: "fluxcd-helm-upgrader@noreply.local"  # Git user email for commits
  forcePush: false                          # Force push branches when they exist

# Health check configuration
healthCheck:
  port: 8080
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Metrics configuration
metrics:
  port: 8080
  serviceMonitor:
    enabled: false
    interval: "30s"
    scrapeTimeout: "10s"
    labels: {}
  prometheusRule:
    enabled: false
    labels: {}

# Logging configuration
logging:
  format: "text"  # Options: "text" or "json"
